let restaurant;var newMap,apiKey=config.MapBoxKey;document.addEventListener("DOMContentLoaded",e=>{window.initMap()}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token="+apiKey,{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery ï¿½ <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img lazyload",t.src=responsiveImgSRC(e),t.setAttribute("data-src",responsiveImgSRC(e)),t.srcset=responsiveImgSRCSET(e),t.alt=`image of ${e.name}`,t.title=`You could be dining at ${e.name}`,document.getElementById("figure-caption").innerHTML=e.name,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.getRestaurantReviewsById(e.id,fillReviewsHTML)}),responsiveImgSRC=(e=>{let t=DBHelper.imageUrlForRestaurant(e),n=t.indexOf(".jpg");return t=t.slice(0,n)+"_320px"+t.slice(n)}),responsiveImgSRCSET=(e=>{let t=DBHelper.imageUrlForRestaurant(e),n=t.lastIndexOf("."),a=`${t.slice(0,n)}_320px.jpg 320w,`;return a+=`\n ${t.slice(0,n)}_480px.jpg 480w,`,a+=`\n ${t.slice(0,n)}.jpg 800w`}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,a.appendChild(r);const s=document.createElement("td");s.innerHTML=e[n],a.appendChild(s),t.appendChild(a)}}),fillReviewsHTML=((e,t=self.restaurant.reviews)=>{const n=document.getElementById("reviews-container"),a=document.createElement("h2");if(a.innerHTML="Reviews",n.appendChild(a),!t){const e=document.createElement("p");return e.innerHTML=`No reviews yet for restaurant with ID = ${self.restaurant.id}`,void n.appendChild(e)}const r=document.getElementById("reviews-list");t.forEach(e=>{r.appendChild(createReviewHTML(e))}),n.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("div");t.appendChild(n);const a=document.createElement("h2");a.className="align-left",a.innerHTML=e.name,n.appendChild(a);const r=document.createElement("h2");r.className="align-right",r.innerHTML=e.date,n.appendChild(r);const s=document.createElement("br");s.className="clear-both",n.appendChild(s);const l=document.createElement("p");l.className="rating",l.innerHTML=`Rating: ${e.rating}`,t.appendChild(l);const i=document.createElement("p");return i.className="rating-comments",i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=` / ${e.name}`,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});